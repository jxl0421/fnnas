# CumeBox2 快速参考

## 系统配置
- **CPU**: S905X (Amlogic Meson GXL)
- **内存**: 1GB
- **存储**: 8GB eMMC

## 优化配置
- **根分区**: 8GB（可扩展）
- **Swap**: 2GB
- **ZRAM**: 512MB（约1-1.5GB压缩后）
- **总可用内存**: 约4-4.5GB

## 服务列表

| 服务名 | 说明 | 状态检查 |
|--------|------|----------|
| cumbox2-oled | OLED显示系统信息 | `systemctl status cumbox2-oled` |
| cumbox2-fan | 风扇自动控制 | `systemctl status cumbox2-fan` |
| cumbox2-key | 按键自定义 | `systemctl status cumbox2-key` |
| zram | ZRAM内存压缩 | `systemctl status zram` |

## 常用命令

### 服务管理
```bash
# 检查所有服务状态
/usr/local/cumbox2/scripts/check_services.sh

# 查看服务状态
systemctl status cumbox2-oled cumbox2-fan cumbox2-key

# 查看服务日志
journalctl -u cumbox2-* -f

# 重启单个服务
systemctl restart cumbox2-oled
systemctl restart cumbox2-fan
systemctl restart cumbox2-key
```

### 系统信息
```bash
# 内存状态
free -h

# Swap状态
swapon --show

# ZRAM状态
zramctl

# 存储使用
df -h

# CPU温度
cat /sys/class/thermal/thermal_zone0/temp

# I2C设备检测
i2cdetect -y 0
```

### 外挂设备管理
```bash
# 图形界面自动挂载
udiskie --tray --automount --notify

# 命令行挂载
udisksctl mount -b /dev/sdX1

# 命令行卸载
udisksctl unmount -b /dev/sdX1

# 查看挂载状态
df -h | grep /media
```

## 硬件配置文件

### /etc/cumbox2/hardware.conf
```bash
OLED_I2C_BUS="0"
OLED_I2C_ADDR="0x3c"
OLED_WIDTH="80"
OLED_HEIGHT="40"

FAN_GPIO="AO_3"
FAN_TEMP_LOW="50"
FAN_TEMP_HIGH="70"

LED_STATUS_GPIO="X_49"
LED_DISK_GPIO="X_4B"

KEY_POWER_GPIO="AO_2"
KEY_RESET_GPIO="AO_9"
```

### /etc/cumbox2/optimization.conf
```bash
SWAP_SIZE="2048"
SWAP_PATH="/swapfile"

ZRAM_ENABLED="true"
ZRAM_SIZE="512"
ZRAM_COMP_ALG="lzo-rle"

VM_SWAPPINESS="10"
VM_VFS_CACHE_PRESSURE="75"
VM_DIRTY_RATIO="15"
VM_DIRTY_BACKGROUND_RATIO="5"

AUTO_MOUNT_ENABLED="true"
AUTO_MOUNT_TARGET="/media"
```

## 服务自动重试机制

所有硬件服务都配置了自动重试：
- **重启延迟**: 10秒
- **重启策略**: 始终重启（Restart=always）
- **日志级别**: 详细日志输出

### 服务启动流程
1. 检测硬件是否就绪
2. 初始化硬件（GPIO、I2C等）
3. 启动主循环
4. 失败后10秒自动重试

## 风扇控制逻辑

| CPU温度 | 风扇状态 |
|----------|----------|
| < 50℃ | 关闭 |
| 50℃ - 69℃ | 保持当前状态 |
| ≥ 70℃ | 开启 |

**检查间隔**: 5秒

## OLED显示内容

- IP地址（优先有线，其次无线）
- CPU温度
- 内存使用率
- 磁盘使用率
- 系统时间

**刷新间隔**: 2秒

## 外挂设备挂载

**挂载点**: /media/
**挂载规则**: 根据设备标签或UUID自动创建目录
**示例**:
- /media/USB_LABEL
- /media/UUID1234

**标准工具**: udisks2

## 故障排查

### 服务不运行
1. 查看服务状态：`systemctl status <service>`
2. 查看服务日志：`journalctl -u <service> -n 50`
3. 服务会自动重试，等待1-2分钟

### OLED不显示
1. 检查I2C设备：`i2cdetect -y 0`
2. 检查framebuffer：`ls -la /dev/fb0`
3. 确认OLED配置正确

### 风扇不转动
1. 检查GPIO配置：`cat /etc/cumbox2/hardware.conf`
2. 检查GPIO导出：`ls /sys/class/gpio/`
3. 检查温度是否超过50℃

### 外挂设备不挂载
1. 手动挂载：`udisksctl mount -b /dev/sdX1`
2. 查看设备：`lsblk`
3. 查看挂载：`df -h`

## 文件位置

| 文件 | 位置 |
|------|------|
| 硬件配置 | /etc/cumbox2/hardware.conf |
| 优化配置 | /etc/cumbox2/optimization.conf |
| 脚本文件 | /usr/local/cumbox2/scripts/ |
| 服务文件 | /lib/systemd/system/cumbox2-*.service |
| 服务日志 | journalctl -u cumbox2-* |

## 性能指标

### 内存使用
- 物理内存: 1GB
- Swap: 2GB
- ZRAM: 512MB（压缩）
- **总可用**: 约4-4.5GB

### 存储使用
- 根分区: 8GB（默认）
- 可扩展: 支持自动扩容到全盘
- 外挂设备: /media/自动挂载

### 响应时间
- 服务启动: 5-10秒
- 自动重试: 10秒间隔
- OLED刷新: 2秒间隔
- 风扇检测: 5秒间隔